# Story 1.2.4: Map Filters UI (Category, Status, Date)

**Epic:** 1.2 Interactive Map with Clustering & Filters  
**Story Points:** 3  
**Sprint:** 1  
**Status:** Not Started

---

## User Story

**As a** user (especially James discovering volunteer opportunities)  
**I want** to filter map pins by category, status, and date  
**So that** I can find specific types of issues to address

---

## Acceptance Criteria

- [ ] Filter panel displays:
  - Mobile: Slide-up sheet from bottom (triggered by "Filter" button in header)
  - Desktop: Sidebar on right side of map (always visible, 280px width)
- [ ] Filter options:
  - Category: All, Waste/Litter (`Delete02` icon), Drainage (`Droplet` icon)
  - Status: All, Pending, Verified, In Progress, Resolved
  - Date Range: Last 7 days, Last 30 days, Last 90 days, All Time
- [ ] Icon-driven UI: Each category/status has icon, minimal text
- [ ] Touch targets: Each filter button 44x44px minimum
- [ ] Multiple selection allowed for category and status (checkboxes)
- [ ] "Apply Filters" button (mobile) or auto-apply on change (desktop)
- [ ] "Clear All Filters" button resets to defaults
- [ ] Filter state persisted in URL query params: `?category=waste&status=verified&date=30d`
- [ ] Pin count updates dynamically: "Showing 23 of 150 issues"
- [ ] Filtered query uses Server Action from Story 1.2.2 with additional params

---

## Technical Implementation

### Components to Create

- `/components/map/MapFilters.tsx`
- `/components/map/__tests__/MapFilters.test.tsx`

### State Management

- Zustand store: `useMapStore({ filters: { category[], status[], dateRange } })`

### Code Structure

```typescript
'use client';
import { Delete02, Droplet, Filter, XCircle } from '@hugeicons/react';
import { useMapStore } from '@/stores/mapStore';
import { useRouter, useSearchParams } from 'next/navigation';

export function MapFilters() {
  const { filters, setFilters } = useMapStore();
  const router = useRouter();
  const searchParams = useSearchParams();

  const updateFilters = (newFilters) => {
    const params = new URLSearchParams();
    if (newFilters.category.length) {
      params.set('category', newFilters.category.join(','));
    }
    if (newFilters.status.length) {
      params.set('status', newFilters.status.join(','));
    }
    params.set('date', newFilters.dateRange);
    router.push(`/?${params.toString()}`);
    setFilters(newFilters);
  };

  return (
    <div className="filter-panel">
      {/* Filter UI */}
    </div>
  );
}
```

---

## Tasks & Subtasks

### Task 1: Create MapFilters Component

- [ ] Create `/components/map/MapFilters.tsx` file
- [ ] Import required Hugeicons
- [ ] Create filter panel structure
- [ ] Mobile: Use Radix UI Dialog for slide-up sheet
- [ ] Desktop: Sidebar with 280px width

### Task 2: Implement Category Filters

- [ ] Create category filter section
- [ ] Add "All" option
- [ ] Add "Waste/Litter" with `Delete02` icon
- [ ] Add "Drainage" with `Droplet` icon
- [ ] Use checkboxes for multiple selection
- [ ] Ensure 44x44px touch targets

### Task 3: Implement Status Filters

- [ ] Create status filter section
- [ ] Add "All" option
- [ ] Add status options: Pending, Verified, In Progress, Resolved
- [ ] Use checkboxes for multiple selection
- [ ] Add status color indicators

### Task 4: Implement Date Range Filters

- [ ] Create date range filter section
- [ ] Add options: Last 7 days, Last 30 days, Last 90 days, All Time
- [ ] Use radio buttons (single selection)
- [ ] Default: All Time

### Task 5: Implement Apply/Clear Buttons

- [ ] Mobile: Add "Apply Filters" button
- [ ] Desktop: Auto-apply on change
- [ ] Add "Clear All Filters" button
- [ ] Reset filters to defaults on clear

### Task 6: URL Query Params Sync

- [ ] Use `useSearchParams` to read URL params
- [ ] Use `useRouter` to update URL params
- [ ] Format: `?category=waste,drainage&status=verified&date=30d`
- [ ] Sync filters from URL on mount
- [ ] Update URL when filters change

### Task 7: Update Server Action with Filters

- [ ] Extend `getMapIssues` Server Action
- [ ] Accept filters parameter
- [ ] Filter by category: `.in('category', filters.category)`
- [ ] Filter by status: `.in('status', filters.status)`
- [ ] Filter by date: `.gte('created_at', calculateDateThreshold(filters.dateRange))`
- [ ] Return filtered results

### Task 8: Display Pin Count

- [ ] Count total pins (unfiltered)
- [ ] Count visible pins (filtered)
- [ ] Display: "Showing 23 of 150 issues"
- [ ] Update count when filters change

### Task 9: State Management with Zustand

- [ ] Update `/stores/mapStore.ts` with filters state
- [ ] Add `filters: { category[], status[], dateRange }` state
- [ ] Add `setFilters` action
- [ ] Add `clearFilters` action

### Task 10: Testing

- [ ] Write unit tests for MapFilters component
- [ ] Test filter selection
- [ ] Test URL param sync
- [ ] Test apply/clear functionality
- [ ] Test pin count updates
- [ ] E2E test: Select filters â†’ pins update on map

---

## Dependencies

- **Blocked by:** Story 1.2.2 (needs getMapIssues Server Action to extend)
- **Blocks:** None
- **Related:** Story 1.2.3 (Clustering works with filtered pins)

---

## Definition of Done

- [x] All acceptance criteria met
- [x] Unit tests written and passing (80% coverage)
- [x] Filter state persisted in URL
- [x] Touch targets 44x44px minimum
- [x] Mobile and desktop layouts working
- [x] Code reviewed and approved
- [x] Deployed to Vercel preview environment

---

## Notes

- Icon imports: `Delete02`, `Droplet`, `Filter`, `XCircle`
- Mobile filter sheet uses Radix UI Dialog
- Desktop sidebar always visible (no hide/show toggle)
- URL params enable shareable filtered map views
- Date threshold calculation: `new Date(Date.now() - days * 24 * 60 * 60 * 1000)`
